<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klang Valley Forest Patches</title>

    <link href="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app-container">
        <aside id="sidebar">
            <div id="sidebar-header">
                <h2>Klang Valley Forest Patches</h2>
                <div class="header-buttons"> <!-- Added class for easier targeting -->
                    <button id="dark-mode-toggle" title="Toggle Dark/Light Mode" aria-label="Toggle dark mode">ðŸŒ“</button>
                    <button id="toggle-sidebar-btn" title="Toggle Sidebar" aria-label="Toggle sidebar" aria-expanded="true">â€¹</button>
                </div>
            </div>

            <div class="sidebar-section" id="filter-section">
                <h3>Filter by Category</h3> <!-- Simplified title -->
                <!-- Checkboxes with color boxes by app.js -->
            </div>

            <div class="sidebar-section" id="info-panel-section">
                <h3>Patch Details</h3>
                <div id="patch-info-content">Select a patch on the map.</div>
            </div>

            <div class="sidebar-section" id="stats-section">
                <h3>Summary Statistics</h3>
                <div id="stats-content">
                    <p>Visible Patches: <span id="visible-patches-count">-</span></p>
                    <p>Total Area: <span id="visible-patches-area">-</span> ha</p>
                    <div id="tier-stats-breakdown">
                        <!-- Tier stats by app.js -->
                    </div>
                </div>
            </div>

            <div class="sidebar-section" id="tools-section">
                <h3>Tools</h3>
                <div id="search-geocoder-container"></div>
                
                <label for="basemap-toggle">Basemap:</label>
                <select id="basemap-toggle">
                    <option value="custom">Custom Style</option>
                    <option value="satellite">Satellite</option>
                </select>

                <div id="area-filter-controls">
                    <h4>Filter by Patch Area (ha)</h4>
                    <div class="area-input-group">
                        <label for="min-area-input">Min:</label>
                        <input type="number" id="min-area-input" placeholder="0" min="0">
                    </div>
                    <div class="area-input-group">
                        <label for="max-area-input">Max:</label>
                        <input type="number" id="max-area-input" placeholder="e.g., 5000" min="0">
                    </div>
                    <div id="area-filter-error" class="filter-error-message" style="display: none;"></div>
                    <div class="area-filter-buttons">
                        <button id="apply-area-filter-btn">Apply Area</button>
                        <button id="reset-area-filter-btn">Reset Area</button>
                    </div>
                </div>
            </div>

            <div id="sidebar-footer">
                <button id="about-btn">About This Project</button>
            </div>
        </aside>

        <main id="map-container">
            <div id="map"></div>
            <div id="loading-indicator" style="display: none;">
                <div class="spinner"></div>
                Loading Map...
            </div>
        </main>
    </div>

    <div id="about-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-modal-btn" role="button" tabindex="0" aria-label="Close modal">Ã—</span>
            <h2>The Klang Valley Forest Patches Project</h2>
            <p>This interactive map shows over 9,000 forest patches extracted from the Klang Valley region in Malaysia. Each patch is classified into one of several tiers using a four-step process that considers key ecological attributes: total area, core area, contiguity index, and perimeter-area ratio.</p>
            <p>Some patches appear in black and are labelled "Excluded." These represent large monoculture plantations that the extraction algorithm could not reliably distinguish from natural forest due to their similar spectral or structural characteristics.</p>
            <p>Built by Ben Galea</p>
            <p>Contact bengalea97@gmail.com for any enquiries</p>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="app.js"></script>
</body>
</html>
